apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
- script: |
    if [ -z $CI ]; then
      label_value=$(oc get -n openshift-operators subscription openshift-gitops-operator -o go-template=$'{{index .spec.config.env "REMOVE_MANAGED_BY_LABEL_ON_ARGOCD_DELETION"}}')
      if [ -z $label_value ]; then
        echo "REMOVE_MANAGED_BY_LABEL_ON_ARGOCD_DELETION not set"
        exit 1
      else
        exit 0
      fi
    else
      label_value=$(oc get -n openshift-operators subscription `subscription=oo- && oc get subscription --all-namespaces | grep $subscription | head -1 | awk '{print $2}'` -o go-template=$'{{index .spec.config.env "REMOVE_MANAGED_BY_LABEL_ON_ARGOCD_DELETION"}}')
      if [ -z $label_value ]; then
        echo "REMOVE_MANAGED_BY_LABEL_ON_ARGOCD_DELETION not set"
        exit 1
      else
        exit 0
      fi
    fi
